// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ------------------ Enums ------------------
enum PropertyType{
  house
  flat
  skyscraper
}
 
enum HeatingType{
  radiator
  airconditioner
  convector
  floor
}
 
enum FurnishingLevel{
  none
  partial
  full
}

enum KitchenLevel{
  none
  partial
  full
}

// ------------------ Models ------------------

//User Model to store user profile information 
//and this is the main table that everything is connected to (maybe change later)
//***User tables API is src/user***
model User{
  idUser Int @id @default(autoincrement())
  firstName String
  lastName String
  connectionEmail String //contactemail (the right word)
  phoneNumber String
 
 //optional fields if you are looking for roommates
  userBio String?
  age Int?
  gender String? //maybe enum later
  language String?
  occupation String?
 
  hasHouse Boolean
  lookingForPeople Boolean
  //lookingForHouse Boolean
 
  login UserLogin?
  tokens UserToken[]
  attributes UserAttributes[]
  roommatesPrefrences RoommatesPrefrences?
  houses HouseListing[]
  houseSearchPrefrenc HouseSearchPrefrences?
}

//UserLogin Model to store user login credentials (done)
//***UserLogin tables API is src/user-login***
model UserLogin{ 
  idUserLogin Int @id @default(autoincrement())
  UserLoginIdUser Int @unique //foreign key to User model, there cant be multiple logins for one user
 
  password String
  email String
 
  user User @relation(fields: [UserLoginIdUser],references: [idUser])
}

//UserToken Model to store user authentication tokens (done)
model UserToken{
  idUserToken Int @id @default(autoincrement())
  userIdToken Int //foreign key to User model, there can be multiple tokens for one user
 
  token String
  expirationDate DateTime
 
  user User @relation(fields: [userIdToken],references: [idUser])
}

/* for pictures - might be implemented later
model ProfileImage {
  idProfileImage Int @id @default(autoincrement())
  url String
  isCover Boolean @default(false)
  uploadedAt DateTime @default(now()) ?
  userId Int

  user User @relation(fields: [userId], references: [idUser], onDelete: Cascade)
}
*/

//+Attributes the user can select for their about themselves (done)
model UserAttributes{
  idUserAttributes Int @id @default(autoincrement())

  attributeName String //e.g. "Non-smoker", "Pet lover", "Early riser", etc.

  Users User[] //relation to HouseListing model, N-to-Many
}

model RoommatesPrefrences{
  idRoommatesPrefrences Int @id @default(autoincrement())
  roommatesPrefrencesIdUser Int @unique //foreign key to User model, one user can have only one set of roommate prefrences
 
  //optional fields cus the user might not want to set any prefrences
  minAge Int?
  maxAge Int?
  gender String?
  language String?

  user User? @relation(fields: [roommatesPrefrencesIdUser],references: [idUser]) //relation to User model but not everyone is looking for roommates
}

//HouseListing Model to store house listings posted by users (done)
model HouseListing{
  idHouse Int @id @default(autoincrement())
  houseIdUser Int //foreign key to User model, there can be multiple listings for one user
 
  description String
  location String
  city String
  rent Float
  propertyType PropertyType //enum
  whichFloor Int? //if its in a building complex
  numberOfRooms Int
  squareMeter Float
  heatingType HeatingType //enum
  furnishingLevel FurnishingLevel //enum
  kitchenLevel KitchenLevel //enum
  bathrooms Int
  airConditioner Boolean
 
  user User? @relation(fields: [houseIdUser],references: [idUser]) //relation to User model but not everyone has a listing
  HouseAttributes HouseAttributes[] //relation to HouseAttributes model, N-to-Many
  //images HouseImage[]
}

/* for pictures - might be implemented later
model HouseImage {
  idHouseImage Int @id @default(autoincrement())
  url String
  isCover Boolean @default(false)
  uploadedAt DateTime @default(now()) ?
  houseId Int

  house HouseListing @relation(fields: [houseId], references: [idHouse], onDelete: Cascade)
}
*/

model HouseSearchPrefrences{
  idHousePrefrences Int @id @default(autoincrement())
  houseSearchIdUser Int @unique //foreign key to User model, one user can have only one set of search prefrences
 
  //these are optional cus if the user doesnt set them, they shouldnt filter anything
  maxRent Float?
  minSquareMeters Float?
  minRooms Int?
  city String?
  propertyType PropertyType?
  heatingType HeatingType?
  furnishingLevel FurnishingLevel?
  kitchenLevel KitchenLevel?
  minBathrooms Int?
 
  user User? @relation(fields: [houseSearchIdUser],references: [idUser]) //relation to User model but not everyone is looking for houses
}

//+Attributes the user can select for their house listing (done)
model HouseAttributes{
  idHouseAttributes Int @id @default(autoincrement())

  attributeName String //e.g. "Smoking", "Garden", "Parking", etc.

  Listings HouseListing[] //relation to HouseListing model, N-to-Many
}
